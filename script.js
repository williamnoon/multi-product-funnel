// Product data
const products = {
    'ai-income': {
        name: 'AI Income Blueprint',
        leadMagnet: 'The 7-Day AI Income Quick Start System',
        tripwire: 'AI Income Toolkit',
        tripwirePrice: 47,
        coreOffer: 'AI Profit Accelerator System',
        corePrice: 197,
        backend1: 'AI Mastery Coaching',
        backend1Price: 997,
        backend2: 'Done-with-You AI Business',
        backend2Price: 2997,
        colors: {
            primary: 'gradient-primary-ai',
            bg: 'gradient-bg-ai'
        },
        icon: 'icon-brain',
        target: 'entrepreneurs and freelancers',
        guarantee: 'Complete access to all AI tools and templates for life',
        content: {
            headline: "Start Earning with AI in Just 7 Days",
            subheadline: "Get the complete system that helped Maria go from zero to $2,100/month using AI tools (no tech skills required)",
            benefits: [
                "7-day step-by-step implementation plan",
                "50+ proven AI prompts that generate income",
                "Complete list of free AI tools to get started",
                "Real case studies and examples"
            ],
            testimonials: [
                { name: "Maria S.", result: "$2,100 in month 1", avatar: "female", initials: "MS" },
                { name: "David L.", result: "$850 in first week", avatar: "male", initials: "DL" },
                { name: "Sarah K.", result: "$3,500 monthly", avatar: "creative", initials: "SK" }
            ],
            tripwireItems: [
                { item: "Complete AI Income Video Course (5 modules)", value: "$197" },
                { item: "147 ChatGPT prompts for income generation", value: "$97" },
                { item: "Done-for-you service templates", value: "$67" },
                { item: "Private community access", value: "$47" }
            ],
            totalValue: "$408",
            goal: "Earn with AI",
            purchaseCount: "127",
            upsellFeatures: [
                "Complete AI Business Implementation System",
                "Advanced automation strategies and workflows",
                "Scaling from $100 to $5,000/month blueprint",
                "Live weekly Q&A sessions with the instructor",
                "Done-with-you case study development",
                "Lifetime access to all updates and new modules"
            ],
            results: "$500-5,000",
            timeframe: "per month within 90 days",
            tier1Features: [
                "Monthly group coaching calls",
                "Private mastermind community",
                "Advanced AI automation training",
                "Direct access to instructor",
                "Weekly live Q&A sessions"
            ],
            tier2Features: [
                "90-day intensive implementation program",
                "Weekly 1-on-1 strategy calls",
                "Custom AI business setup included",
                "Done-with-you case study development",
                "Guaranteed results or money back"
            ]
        }
    },
    'crypto-wealth': {
        name: 'Crypto Money Machine',
        leadMagnet: 'The 30-Day Crypto Wealth Blueprint',
        tripwire: 'Crypto Profit Toolkit',
        tripwirePrice: 67,
        coreOffer: 'Crypto Wealth Accelerator',
        corePrice: 297,
        backend1: 'Crypto Elite Mastermind',
        backend1Price: 1497,
        backend2: 'Private Crypto Coaching',
        backend2Price: 4997,
        colors: {
            primary: 'gradient-primary-crypto',
            bg: 'gradient-bg-crypto'
        },
        icon: 'icon-crypto',
        target: 'crypto investors and traders',
        guarantee: 'Every strategy, tool, and analysis method included with lifetime updates',
        content: {
            headline: "Build Crypto Wealth in 30 Days",
            subheadline: "Discover the exact blueprint that helped John turn $500 into $15,000 in crypto profits (even during market volatility)",
            benefits: [
                "30-day crypto wealth building strategy",
                "Risk management techniques that preserve capital",
                "Top 10 undervalued coins to watch",
                "DeFi strategies for passive income"
            ],
            testimonials: [
                { name: "John R.", result: "$15K profit in 30 days", avatar: "male", initials: "JR" },
                { name: "Lisa M.", result: "300% portfolio growth", avatar: "female", initials: "LM" },
                { name: "Mike T.", result: "$5K passive income", avatar: "creative", initials: "MT" }
            ],
            tripwireItems: [
                { item: "Advanced crypto trading strategies course", value: "$297" },
                { item: "Portfolio tracking templates", value: "$97" },
                { item: "DeFi opportunity alerts", value: "$127" },
                { item: "Risk management calculator", value: "$77" }
            ],
            totalValue: "$598",
            goal: "Build Crypto Wealth",
            purchaseCount: "89",
            upsellFeatures: [
                "Advanced crypto portfolio management system",
                "Exclusive alpha calls with market insights",
                "Personal crypto wealth building roadmap",
                "Risk management and position sizing calculator",
                "Access to private trading signals",
                "Weekly market analysis and opportunities"
            ],
            results: "25-300%",
            timeframe: "portfolio growth potential",
            tier1Features: [
                "Monthly portfolio review sessions",
                "Exclusive alpha trading community",
                "Advanced DeFi strategies training",
                "Market analysis and insights",
                "Personal trading plan development"
            ],
            tier2Features: [
                "90-day wealth acceleration program",
                "Weekly 1-on-1 portfolio coaching",
                "Custom investment strategy creation",
                "Direct access to exclusive deals",
                "Guaranteed portfolio growth plan"
            ]
        }
    },
    'app-empire': {
        name: 'AI App Empire',
        leadMagnet: 'The No-Code App Creation Guide',
        tripwire: 'App Builder Toolkit',
        tripwirePrice: 57,
        coreOffer: 'Vibe Coding Mastery',
        corePrice: 397,
        backend1: 'App Development Accelerator',
        backend1Price: 1997,
        backend2: 'App Empire Mastermind',
        backend2Price: 5997,
        colors: {
            primary: 'gradient-primary-app',
            bg: 'gradient-bg-app'
        },
        icon: 'icon-mobile',
        target: 'aspiring app developers',
        guarantee: 'Complete app development framework with all templates and code',
        content: {
            headline: "Build Apps Without Coding",
            subheadline: "The complete no-code system that helped Jennifer create a $10K/month app business (zero programming experience)",
            benefits: [
                "Complete no-code app development framework",
                "Step-by-step app monetization strategies",
                "App store optimization secrets",
                "Done-for-you app templates"
            ],
            testimonials: [
                { name: "Jennifer B.", result: "$10K/month app business", avatar: "female", initials: "JB" },
                { name: "Carlos R.", result: "3 successful apps launched", avatar: "male", initials: "CR" },
                { name: "Amy W.", result: "$25K app sale", avatar: "creative", initials: "AW" }
            ],
            tripwireItems: [
                { item: "No-code app development masterclass", value: "$397" },
                { item: "50+ app templates and components", value: "$197" },
                { item: "App store optimization toolkit", value: "$97" },
                { item: "Monetization strategy playbook", value: "$127" }
            ],
            totalValue: "$818",
            goal: "Create Apps",
            purchaseCount: "156",
            upsellFeatures: [
                "Complete app development and launch system",
                "Advanced monetization and scaling strategies",
                "App store optimization and marketing toolkit",
                "Personal app idea validation and feedback",
                "Access to exclusive development resources",
                "Monthly mastermind calls with successful developers"
            ],
            results: "$1,000-10,000",
            timeframe: "monthly app revenue potential",
            tier1Features: [
                "Monthly app development workshops",
                "Private developer community",
                "Advanced monetization strategies",
                "App store optimization coaching",
                "Technical support and guidance"
            ],
            tier2Features: [
                "90-day app launch acceleration program",
                "Weekly 1-on-1 development coaching",
                "Custom app development assistance",
                "Done-with-you app creation",
                "Guaranteed app launch or refund"
            ]
        }
    }
};

// Current state
let currentProduct = 'ai-income';
let currentStep = 'traffic';
let email = '';
let timeRemaining = 900; // 15 minutes
let timerInterval;
let customerData = {
    hasOptedIn: false,
    hasPurchasedTripwire: false,
    hasPurchasedCore: false
};

// Initialize
function init() {
    updateProductContent();
    startTimer();
    updateProgressBar();
}

// Product switching
function switchProduct(productKey) {
    currentProduct = productKey;
    currentStep = 'traffic';
    email = '';
    timeRemaining = 900;
    customerData = {
        hasOptedIn: false,
        hasPurchasedTripwire: false,
        hasPurchasedCore: false
    };
    
    updateProductContent();
    showPage('traffic');
    updateProductButtons();
    updateNavigation();
}

// Update product buttons
function updateProductButtons() {
    const buttons = document.querySelectorAll('.product-btn');
    buttons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.product === currentProduct) {
            btn.classList.add('active');
        }
    });
}

// Update product content
function updateProductContent() {
    const product = products[currentProduct];
    
    // Update background classes
    const trafficPage = document.getElementById('traffic-page');
    trafficPage.className = `page active traffic-page ${product.colors.bg}`;
    
    // Update content
    document.querySelector('.main-headline').innerHTML = 
        product.content.headline + '<br><span class="highlight">Starting Today</span>';
    document.getElementById('subheadline').textContent = product.content.subheadline;
    document.getElementById('lead-magnet-title').textContent = `ðŸŽ FREE: ${product.leadMagnet}`;
    
    // Update benefits
    const benefitsList = document.getElementById('benefits-list');
    benefitsList.innerHTML = product.content.benefits.map(benefit => `<li>${benefit}</li>`).join('');
    
    // Update guide mockup
    const guideMockup = document.getElementById('guide-mockup');
    guideMockup.className = `guide-mockup ${product.colors.primary}`;
    guideMockup.innerHTML = `
        <div>
            <div class="large-icon ${product.icon}"></div>
            <p style="font-weight: bold;">Complete Guide</p>
        </div>
    `;
    
    // Update testimonials
    const socialProof = document.getElementById('social-proof');
    socialProof.innerHTML = product.content.testimonials.map(testimonial => `
        <div class="testimonial">
            <div class="avatar-professional ${testimonial.avatar}">${testimonial.initials}</div>
            <p class="name">${testimonial.name}</p>
            <p class="result">${testimonial.result}</p>
        </div>
    `).join('');
    
    // Update tripwire content
    updateTripwireContent();
    updateUpsellContent();
    updateBackendContent();
    updatePrices();
}

// Update tripwire content
function updateTripwireContent() {
    const product = products[currentProduct];
    
    document.getElementById('goal-text').textContent = product.content.goal;
    document.getElementById('tripwire-price').textContent = product.tripwirePrice;
    document.getElementById('tripwire-name').textContent = product.tripwire;
    document.getElementById('guarantee-text').innerHTML = `<strong>Our Guarantee:</strong> ${product.guarantee}`;
    document.getElementById('purchase-count').textContent = product.content.purchaseCount;
    document.getElementById('final-price').textContent = product.tripwirePrice;
    document.getElementById('cta-price').textContent = product.tripwirePrice;
    document.getElementById('total-value').textContent = product.content.totalValue;
    
    // Update value items
    const valueItems = document.getElementById('value-items');
    valueItems.innerHTML = product.content.tripwireItems.map(item => `
        <div class="value-item">
            <span class="description">${item.item}</span>
            <span class="price">${item.value}</span>
        </div>
    `).join('');
}

// Update upsell content
function updateUpsellContent() {
    const product = products[currentProduct];
    
    document.getElementById('confirmed-product').textContent = product.tripwire;
    document.getElementById('normal-price').textContent = Math.round(product.corePrice * 2.5);
    document.getElementById('savings1').textContent = Math.round(product.tripwirePrice * 3);
    document.getElementById('savings2').textContent = Math.round(product.corePrice * 1.5);
    document.getElementById('core-offer-name').textContent = product.coreOffer;
    document.getElementById('upsell-title').textContent = product.coreOffer;
    document.getElementById('results-range').textContent = product.content.results;
    document.getElementById('results-timeframe').textContent = product.content.timeframe;
    document.getElementById('core-price').textContent = product.corePrice;
    
    // Update features
    const upsellFeatures = document.getElementById('upsell-features');
    upsellFeatures.innerHTML = product.content.upsellFeatures.map(feature => `<li>${feature}</li>`).join('');
}

// Update backend content
function updateBackendContent() {
    const product = products[currentProduct];
    
    document.getElementById('target-audience').textContent = product.target;
    document.getElementById('backend1-name').textContent = product.backend1;
    document.getElementById('backend1-price').textContent = product.backend1Price;
    document.getElementById('backend2-name').textContent = product.backend2;
    document.getElementById('backend2-price').textContent = product.backend2Price;
    document.getElementById('backend1-name-btn').textContent = product.backend1;
    
    // Update tier features
    const tier1Features = document.getElementById('tier1-features');
    tier1Features.innerHTML = product.content.tier1Features.map(feature => `<li>${feature}</li>`).join('');
    
    const tier2Features = document.getElementById('tier2-features');
    tier2Features.innerHTML = product.content.tier2Features.map(feature => `<li>${feature}</li>`).join('');
    
    // Update popular card gradient
    const popularCard = document.querySelector('.tier-card.popular');
    popularCard.className = `tier-card popular ${product.colors.primary}`;
}

// Update prices in navigation
function updatePrices() {
    const product = products[currentProduct];
    document.getElementById('nav-tripwire-price').textContent = product.tripwirePrice;
    document.getElementById('nav-core-price').textContent = product.corePrice;
}

// Page navigation
function showPage(pageId) {
    document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
    document.getElementById(pageId + '-page').classList.add('active');
    currentStep = pageId;
    updateNavigation();
    updateProgressBar();
}

// Update navigation
function updateNavigation() {
    const steps = ['traffic', 'thankyou', 'tripwire', 'upsell', 'backend'];
    const currentIndex = steps.indexOf(currentStep);
    
    document.querySelectorAll('.nav-btn').forEach((btn, index) => {
        btn.classList.remove('active', 'completed');
        
        if (btn.dataset.page === currentStep) {
            btn.classList.add('active');
        } else if (index < currentIndex) {
            btn.classList.add('completed');
        }
    });
}

// Update progress bar
function updateProgressBar() {
    const steps = ['traffic', 'thankyou', 'tripwire', 'upsell', 'backend'];
    const currentIndex = steps.indexOf(currentStep);
    const progress = ((currentIndex + 1) / steps.length) * 100;
    
    const progressBar = document.getElementById('progress-bar');
    progressBar.style.width = `${progress}%`;
}

// Timer functions
function startTimer() {
    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        if (timeRemaining > 0 && currentStep === 'tripwire') {
            timeRemaining--;
            updateTimer();
        }
    }, 1000);
}

function updateTimer() {
    const minutes = Math.floor(timeRemaining / 60);
    const seconds = timeRemaining % 60;
    document.getElementById('timer').textContent = 
        `${minutes}:${seconds.toString().padStart(2, '0')}`;
}

// Email validation function
function validateEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

// Show validation message
function showValidationMessage(input, message, isError = true) {
    // Remove existing validation message
    const existingMessage = input.parentNode.querySelector('.validation-message');
    if (existingMessage) {
        existingMessage.remove();
    }
    
    // Create new validation message
    const validationDiv = document.createElement('div');
    validationDiv.className = `validation-message ${isError ? 'error' : 'success'}`;
    validationDiv.textContent = message;
    
    // Insert after the input
    input.parentNode.insertBefore(validationDiv, input.nextSibling);
    
    // Remove message after 3 seconds
    setTimeout(() => {
        if (validationDiv.parentNode) {
            validationDiv.remove();
        }
    }, 3000);
}

// Action handlers
function handleOptIn() {
    const emailInput = document.getElementById('email-input');
    email = emailInput.value.trim();
    
    // Reset input styles
    emailInput.classList.remove('error', 'success');
    
    if (!email) {
        emailInput.classList.add('error');
        showValidationMessage(emailInput, 'Please enter your email address');
        return;
    }
    
    if (!validateEmail(email)) {
        emailInput.classList.add('error');
        showValidationMessage(emailInput, 'Please enter a valid email address');
        return;
    }
    
    // Success - add success styling
    emailInput.classList.add('success');
    showValidationMessage(emailInput, 'Email validated successfully!', false);
    
    // Proceed with opt-in after short delay
    setTimeout(() => {
        customerData.hasOptedIn = true;
        document.getElementById('lead-magnet-name').textContent = products[currentProduct].leadMagnet;
        document.getElementById('user-email').textContent = email;
        document.getElementById('tripwire-preview').textContent = 
            `Want to skip the learning curve? Get our complete ${products[currentProduct].tripwire} with everything you need for a special launch price.`;
        showPage('thankyou');
    }, 800);
}

function handleTripwirePurchase() {
    customerData.hasPurchasedTripwire = true;
    showPage('upsell');
}

function handleCorePurchase() {
    customerData.hasPurchasedCore = true;
    showPage('backend');
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Product selector buttons
    document.querySelectorAll('.product-btn').forEach(btn => {
        btn.addEventListener('click', () => switchProduct(btn.dataset.product));
    });
    
    // Navigation buttons
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.addEventListener('click', () => showPage(btn.dataset.page));
    });
    
    init();
});